!function(V,U,T,S){var M,O,R=U.ui.Widget,J=(U.Class,U.Constants,U.format),z=document,P=(V.extend,V.map,V.each,V.proxy),L=U.error,K=U.is["boolean"],y=U.is.object,B=U.is.defined,D=(U.to.number,"close"),E="minimize",F="maximize",G="resize",H="scroll",C="pin",N="overflow",A="hidden",Q="px",I="center";M={title:"",titleBarButtons:["pin","minimize","maximize","close"],content:S,cls:S,visible:!0,pinned:!1,modal:!1,width:400,height:300,resizable:{maxWidth:S,maxHeight:S,minWidth:200,minHeight:150},draggable:!0,position:S,appendToBody:!1,events:{}},O=R.extend({init:function(){R.fn.init.apply(this,arguments),B(this.initialOptions.titleBarButtons)&&(this.options.titleBarButtons=this.initialOptions.titleBarButtons);var x,W,b,w=this,u=w.options,a=u.cls,Y=u.dieOnError,f=u.titleBarButtons,g=u.resizable,k=u.draggable,l=u.content,X=u.position,m=V(w.element),e=!1;return"div"!==V(m).prop("tagName").toLowerCase()?void L("shieldWindow: Underlying element is not DIV",Y):f&&f.length>0&&!U.ui.Button?void L("shieldWindow: The titleBarButtons setting requires ShieldUI Button to be loaded",Y):(w._eventNS="shieldWindow"+w.getInstanceId(),u.appendToBody?(m.appendTo(z.body),w._parentIsBody=!0):w._parentIsBody="body"==m.parent().prop("tagName").toLowerCase(),w._origHtml=m.html(),m.empty(),m.addClass("sui-window"+(a?" "+a:"")),b={width:u.width+Q,height:u.height+Q,position:"absolute"},m.css(b),w.titleBarEl=x=V('<div class="sui-window-titlebar"><div class="sui-window-title">'+u.title+'</div><div class="sui-window-icons"></div></div>').appendTo(m),w._initTitleBarButtons(),w.contentEl=W=V('<div class="sui-window-content"></div>').appendTo(m),w._fixContent(),y(X)?m.css(X):e=!0,g&&(K(g)&&(g={}),w.resizable=new U.ui.Resizable(m,g),w.resizable.on("resized",P(w._fixContent,w))),k&&(K(k)&&(k={}),k.handle=w.titleBarEl,w.draggable=new U.ui.Draggable(m,k)),w._hasIframe=!1,l?l.template?l.template.dataUrl?V.ajax({url:l.template.dataUrl,dataType:"json",success:function(h,c,i){w.content(J(l.template.body,h))},error:function(i,h,c){w.content("Error occured while reading URL: "+h+" - "+c)}}):w.content(J(l.template.body,l.template.data)):l.remote?l.remote.iframe?(w._hasIframe=!0,w.content('<iframe class="sui-window-iframe" src="'+l.remote.url+'" style="border:none; border-width:0px; width:100%; height:100%;"></iframe>')):w.contentEl.load(l.remote.url):w.content(w._origHtml):w.content(w._origHtml),w._minimized=!1,w._maximized=!1,w._destroyed=!1,w.pinned(!!u.pinned),w.visible(!!u.visible),void (e&&w.center()))},_initTitleBarButtons:function(){var m,l,a,o,p=this,k=p.options,n=k.titleBarButtons,g=k.modal;if(p.titleBarButtons={},n&&n.length>0){for(m=p.titleBarEl.find(".sui-window-icons"),o=0;o<n.length;o++){a=n[o],("pin"===a||"minimize"===a||"maximize"===a||"close"===a)&&(g&&"close"!==a||(l="pin"==a?"_onPin":"minimize"==a?"_onMinimize":"maximize"==a?"_onMaximize":a,p.titleBarButtons[a]=V('<button><div class="sui-sprite sui-window-button-icon sui-window-button-icon-'+a+'"></div></button>').appendTo(m).shieldButton({cls:"sui-window-button",events:{click:P(p[l],p,!0)}}).swidget()))}m.on("mousedown",function(b){return b.preventDefault(),b.stopPropagation(),!1})}},_destroyTitleBarButtons:function(){var e,f=this,d=f.titleBarButtons;for(e in d){d.hasOwnProperty(e)&&d[e].destroy()}f.titleBarButtons={}},_createModal:function(){var a=this,h=V(a._parentIsBody?T:a.element.parent()),g=V(h).scrollTop(),c=V(h).scrollLeft();a._lockScroll(),a._modal=V('<div class="sui-window-modal"></div>').insertBefore(a.element).css({top:g,left:c})},_closeModal:function(){var a=this;V(a._modal).remove(),a._unlockScroll()},_lockScroll:function(){var a=this,d=a.element.parent();a._scrollTop=V(d).scrollTop(),a._scrollLeft=V(d).scrollLeft(),a._parentOverflow=V(d).css(N),d.css(N,A).scrollTop(a._scrollTop).scrollLeft(a._scrollLeft)},_unlockScroll:function(){var d=this,c=d.element.parent();c.css(N,d._parentOverflow).scrollTop(d._scrollTop).scrollLeft(d._scrollLeft)},_fixContent:function(){var a=this;V(a.contentEl).outerWidth(V(a.element).innerWidth()).innerHeight(V(a.element).innerHeight()-V(a.titleBarEl).outerHeight()),a._hasIframe&&V(a.contentEl).find(".sui-window-iframe").width(V(a.contentEl).width()).height(V(a.contentEl).height())},center:function(){var b=this,a=V(b.element);U.ui.Position.Set(a,b._parentIsBody?T:a.parent(),{source:I,target:I})},position:function(a){V(this.element).css(a)},getHeight:function(){V(this.element).css("height")},getWidth:function(){V(this.element).css("width")},getPosition:function(){var a=V(this.element);return{left:a.css("left"),top:a.css("top")}},content:function(){var e=this,a=V(e.contentEl),f=[].slice.call(arguments);return f.length>0?(a.empty(),void a.append(f)):a.html()},resize:function(a){V(this.element).css(a),this._fixContent()},_scroll:function(c){var a=this,h=V(a.element),f=a._parentIsBody;a._pinned&&h.css({left:a.originalPosition.left+V(f?T:h.parent()).scrollLeft()+Q,top:a.originalPosition.top+V(f?T:h.parent()).scrollTop()+Q})},_onPin:function(b){this.pinned(!this._pinned,b)},pinned:function(){var p,l,a=this,o=[].slice.call(arguments),n=V(a.element),g=a._parentIsBody,m=a.titleBarEl,c=m.find(".sui-window-button-icon-pin").length>0?m.find(".sui-window-button-icon-pin"):m.find(".sui-window-button-icon-unpin");return o.length<=0?a._pinned:(p=!!o[0],void (a._pinned!=p&&(o[1]&&(l=a.trigger(C,{pinned:p}),l.isDefaultPrevented())||(a._pinned=p,c.removeClass("sui-window-button-icon-pin sui-window-button-icon-unpin"),c.addClass(a._pinned?"sui-window-button-icon-pin":"sui-window-button-icon-unpin"),a._pinned?(a.originalPosition=n.position(),V(g?T:n.parent()).on(H+"."+a._eventNS,P(a._scroll,a)),a.draggable&&a.draggable.enabled(!1)):(V(g?T:n.parent()).off(H+"."+a._eventNS),a.origininalPosition=null,a.draggable&&a.draggable.enabled(!0))))))},_onMinimize:function(b){this.minimized(!0,b)},minimized:function(){var o,q,l,r=this,n=[].slice.call(arguments),m=V(r.element),k=V(r.contentEl),p=r.titleBarEl,a=r.titleBarButtons.minimize;return n.length<=0?r._minimized:(q=!!n[0],void (r._minimized!=q&&(n[1]&&(l=r.trigger(E,{minimized:q}),l.isDefaultPrevented())||(r._minimized=q,o=p.find(".sui-window-button-icon-minimize").length>0?p.find(".sui-window-button-icon-minimize"):p.find(".sui-window-button-icon-unminimize"),o.removeClass("sui-window-button-icon-minimize sui-window-button-icon-unminimize"),o.addClass(r._minimized?"sui-window-button-icon-unminimize":"sui-window-button-icon-minimize"),q?(r._onMinCurrHeight=m.height(),m.height(p.height()),k.hide(),r.resizable&&r.resizable.enabled(!1)):(m.height(r._onMinCurrHeight),k.show(),r.resizable&&r.resizable.enabled(!0)),a&&a.visible(!q)))))},_onMaximize:function(c){var d=this;d._minimized?d.minimized(!1,c):d.maximized(!d._maximized,c)},maximized:function(){var o,c,n,a,r=this,m=[].slice.call(arguments),q=V(r.element),p=r._beforeMaximize,g=V(r.titleBarEl);return m.length>0?(o=!!m[0],c=!!m[1],r._minimized&&r.minimized(!1,!1),r._maximized!=o&&(c&&(a=r.trigger(F,{maximized:o}),a.isDefaultPrevented())||(r._maximized=!!o,n=g.find(".sui-window-button-icon-maximize").length>0?g.find(".sui-window-button-icon-maximize"):g.find(".sui-window-button-icon-restore"),n.removeClass("sui-window-button-icon-maximize sui-window-button-icon-restore"),n.addClass(r._maximized?"sui-window-button-icon-restore":"sui-window-button-icon-maximize"),r._maximized?(r._beforeMaximize={top:q.css("top"),left:q.css("left"),width:q.width(),height:q.height()},r.resize({width:"100%",height:V(r._parentIsBody?T:q.parent()).height()}),r._lockScroll(),r.center(),r._parentIsBody&&V(T).on(G+"."+r._eventNS,P(r._onWinResizeMax,r))):(p&&(q.css({top:p.top,left:p.left}),r.resize({width:p.width,height:p.height})),r._unlockScroll(),r._parentIsBody&&(V(T).off(G+"."+r._eventNS),r._winResize=null)))),void 0):r._maximized},_onWinResizeMax:function(){var a=this;V(a.element).height(V(T).height()),a._fixContent()},close:function(f){var e,d=this;f&&(e=d.trigger(D),e.isDefaultPrevented())||d.destroy()},visible:function(){var d=this,c=[].slice.call(arguments);if(!d._destroyed){return c.length>0&&d.options.modal&&(c[0]?d._createModal():d._closeModal()),R.fn.visible.apply(d,arguments)}},destroy:function(){var a=this,d=a.options.cls;a.visible(!1),a._destroyed=!0,a.resizable&&(a.resizable.destroy(),a.resizable=null),a.draggable&&(a.draggable.destroy(),a.draggable=null),a._destroyTitleBarButtons(),a.maximized(!1),a.pinned(!1),V(a.element).removeClass("sui-window"+(d?" "+d:"")),a._origHtml&&(V(a.element).html(a._origHtml),a._origHtml=null),R.fn.destroy.call(a)}}),O.defaults=M,U.ui.plugin("Window",O)}(jQuery,shield,this);