!function(ac,aa,F,Y){var G,R,ad,Z,H,M,I,O=aa.ui.Widget,K=aa.Class,N=aa.DataSource,L=(document,Math.abs,Math.min),D=Math.max,T=Math.pow,U=(Math.floor,ac.proxy),V=(ac.each,ac.map,aa.format),C=aa.to["int"],J=aa.error,W=aa.is,S=W.defined,E=(W.string,W.object,W.func,aa.to.number,"squarified"),ab="horizontal",X="vertical",P="click",Q="disabled";ad=K.extend({init:function(f,j,i,h){var g=this;g.left=f,g.top=j,g.width=i,g.height=h},getSize:function(){return L(this.width,this.height)},getRowContainers:function(q){var r,p=this,o=p.left,n=p.top,j=p.sum(q),m=j/p.height,l=j/p.width,k=[];if(p.width>=p.height){for(r=0;r<q.length;r++){k.push({left:o,top:n,right:o+m,bottom:n+q[r].targetValue/m,dataItem:q[r]}),n+=q[r].targetValue/m}}else{for(r=0;r<q.length;r++){k.push({left:o,top:n,right:o+q[r].targetValue/l,bottom:n+l,dataItem:q[r]}),o+=q[r].targetValue/l}}return k},remainingArea:function(k){var n,m,j,i,l,a=this;return a.width>=a.height?(n=k/a.height,j=a.width-n,l=new ad(a.left+n,a.top,j,a.height)):(m=k/a.width,i=a.height-m,l=new ad(a.left,a.top+m,a.width,i)),l},sum:function(d){var e,f=0;for(e=0;e<d.length;e++){f+=d[e].targetValue}return f}}),Z=K.extend({init:function(){},sort:function(b){b.sort(function(d,c){return c.targetValue-d.targetValue})},sum:function(d){var e,f=0;for(e=0;e<d.length;e++){f+=d[e].targetValue}return f},min:function(f){var e,d=Y;for(e=0;e<f.length;e++){(!S(d)||d>f[e].targetValue)&&(d=f[e].targetValue)}return d},max:function(f){var e,d=Y;for(e=0;e<f.length;e++){(!S(d)||d<f[e].targetValue)&&(d=f[e].targetValue)}return d}}),Z.create=function(b){return b===E?new I:b===ab?new H:new M},H=Z.extend({init:function(){Z.fn.init.apply(this,arguments)},execute:function(w,A,c,z,B){var u,x,af,y,ae,v,t=this,a=t.sum(w),s=A.left,g=A.top;for(B||(B=ab),t.sort(w),v=0;v<w.length;v++){af=w[v],u=B===ab?A.width*af.targetValue/a:A.width,x=B===ab?A.height:A.height*af.targetValue/a,af.items&&0!==af.items.length?(y=z.createGroup(c,new ad(s,g,u,x)),ae=z.createTitle(y,z.getItemText(af)),ae=new ad(ae.left-y.position().left,ae.top-y.position().top,ae.width,ae.height),t.execute(af.items,ae,y,z,B===ab?X:ab)):z.createItem(c,{left:s,top:g,width:u,height:x,dataItem:af}),B===ab?s+=u:g+=x}}}),M=Z.extend({init:function(){Z.fn.init.apply(this,arguments)},execute:function(w,A,c,z,B){var u,x,af,y,ae,v,t=this,a=t.sum(w),s=A.left,g=A.top;for(B||(B=X),t.sort(w),v=0;v<w.length;v++){af=w[v],x=B===X?A.height*af.targetValue/a:A.height,u=B===X?A.width:A.width*af.targetValue/a,af.items&&0!==af.items.length?(y=z.createGroup(c,new ad(s,g,u,x)),ae=z.createTitle(y,z.getItemText(af)),ae=new ad(ae.left-y.position().left,ae.top-y.position().top,ae.width,ae.height),t.execute(af.items,ae,y,z,B===X?ab:X)):z.createItem(c,{left:s,top:g,width:u,height:x,dataItem:af}),B===X?g+=x:s+=u}}}),I=Z.extend({init:function(){Z.fn.init.apply(this,arguments)},execute:function(a,o,m,t){var n,p,v,r,u,q,s=this;for(s.sort(a),n=s._squarifyCore(s._normalize(a,o.width*o.height,t),[],o,[]),p=s._getTreemap(n),q=0;q<p.length;q++){v=p[q],v.dataItem.items&&0!==v.dataItem.items.length?(r=t.createGroup(m,new ad(v.left,v.top,v.right-v.left,v.bottom-v.top)),u=t.createTitle(r,t.getItemText(v.dataItem)),u=new ad(u.left-r.position().left,u.top-r.position().top,u.width,u.height),s.execute(v.dataItem.items,u,r,t)):t.createItem(m,{left:v.left,top:v.top,width:v.right-v.left,height:v.bottom-v.top,dataItem:v.dataItem})}},_squarifyCore:function(o,j,i,p){var l,m,k,n=this;return 0===o.length?void p.push(i.getRowContainers(j)):(l=i.getSize(),m=o[0],n._verifyRatio(j,m,l)?(j.push(m),n._squarifyCore(o.slice(1),j,i,p)):(k=i.remainingArea(n.sum(j)),p.push(i.getRowContainers(j)),n._squarifyCore(o,[],k,p)),p)},_getTreemap:function(h){var f,e,g=[];for(f=0;f<h.length;f++){for(e=0;e<h[f].length;e++){g.push(h[f][e])}}return g},_verifyRatio:function(i,j,n){var h,m,l,k=this;return 0===i.length?!0:(h=i.slice(),h.push(j),m=k._calculateRatio(i,n),l=k._calculateRatio(h,n),m>=l)},_calculateRatio:function(h,l){var g=this,j=g.min(h),i=g.max(h),k=g.sum(h);return D(T(l,2)*i/T(k,2),T(k,2)/(T(l,2)*j))},_normalize:function(p,o,k){var j,n=this,m=n.sum(p),l=o/m,i=[];for(j=0;j<p.length;j++){i[j]=p[j],i[j].targetValue=i[j].targetValue*l}return i}}),G={cls:Y,enabled:!0,width:Y,height:Y,title:Y,dataSource:Y,readDataSource:!0,type:"squarified",valueTemplate:"{value}",textTemplate:"{title}",colorTemplate:"{color}",colors:["#1E98E4","#FFC500","#5CB85C","#FF2A00","#6D31FF","#00B2A1","#FF8000","#84B3DC"],tooltip:{enabled:!1,template:"{title}: {value}",filter:".sui-treemap-item",delay:80,position:"top"},events:{}},R=O.extend({init:function(){O.fn.init.apply(this,arguments);var l,b=this,m=ac(b.element),n=b.options,k=n.cls,j=n.dataSource,i=n.dieOnError;return"div"!==m.prop("tagName").toLowerCase()?void J("shieldTreeMap: Underlying element is not DIV.",i):(m.addClass("sui-treemap "+(k?" "+k:"")),S(n.width)&&m.css("width",n.width),S(n.height)&&m.css("height",n.height),j?(b.dataSource=N.create(j),b._eventNS=l=".shieldTreeMap"+b.getInstanceId(),b.containers=[],b.colorIndex=0,ac(F).on("resize"+l,U(b._onWinResize,b)),b.dataSource.on("change"+l,U(b._dsChange,b)),n.readDataSource&&b.dataSource.read(),void b.enabled(n.enabled)):(b.destroy(),void J("shieldTreemap: dataSource is not defined.",i)))},_dsChange:function(){var d=this,c=d.element;d._create(),d._createTooltip(),d._elWidth=c.width(),d._elHeight=c.height()},_onWinResize:function(c){var d=this;d._onWinResTimeout&&clearTimeout(d._onWinResTimeout),d._onWinResTimeout=setTimeout(U(d._winResized,d),100)},_winResized:function(){var d=this,c=d.element;(d._elWidth!==c.width()||d._elHeight!==c.height())&&d.refresh()},_createTooltip:function(){var b=this,d=b.options.tooltip;d.enabled&&(b.tooltip?b.tooltip.refresh(d):b.tooltip=ac(b.element).children(".sui-treemap-group").first().shieldTooltip(d).swidget())},_create:function(){var m,a=this,n=a.element,k=a.dataSource.data,j=a.options,e=Z.create(j.type),l=new ad(0,0,n.innerWidth(),n.innerHeight());n.empty(),a._prepareData(k),m=a.createGroup(n,l),l=a.createTitle(m,j.title),e.execute(k,l,m,a)},_prepareData:function(d){var e,f=this;for(e=0;e<d.length;e++){d[e].targetValue=f.getItemValue(d[e]),d[e].items&&f._prepareData(d[e].items)}},createTitle:function(r,o){var q,f,d,c,b,a=this,p=a.options.type===ab;return"undefined"===o||o===Y?new ad(r.position().left,r.position().top,r.innerWidth(),r.innerHeight()):(q=ac('<div class="sui-treemap-title"></div>').appendTo(r),p&&q.innerHeight(r.outerHeight()),q.append('<div class="sui-treemap-title-inner">'+o.replace(/\s+/,"&nbsp;")+"</div>"),aa.ui.Position.Set(q.find(".sui-treemap-title-inner"),q,{source:"center",target:"center"}),f=p?r.position().left+q.outerWidth():r.position().left,d=p?r.position().top:r.position().top+q.outerHeight(),c=p?r.innerWidth()-q.outerWidth():r.innerWidth(),b=p?r.innerHeight():r.innerHeight()-q.outerHeight(),new ad(f,d,c,b))},createGroup:function(d,f){var e=this;return e._createContainer(d,f).addClass("sui-treemap-group sui-treemap-group-"+e.options.type)},createItem:function(k,c){var n,i=this,m=i.options,l=m.tooltip,j=(m.type===ab,i.getItemText(c.dataItem));n=i._createContainer(k,c),n.addClass("sui-treemap-item").css("backgroundColor",i._getContentColor(c.dataItem)).on(P,U(i._contentClick,i,c.dataItem)),l.enabled&&n.attr("title",V(l.template,c.dataItem)),i.containers.push(n),n.html(j)},_contentClick:function(c){var d=this;d._enabled&&d.trigger(P,{title:d.getItemText(c),value:d.getItemValue(c),item:c})},_createContainer:function(d,b){return ac("<div/>").appendTo(d).css({left:b.left,top:b.top,width:b.width,height:b.height})},_getContentColor:function(f){var e=this,d=e.options.colors;return e._getItemColor(f)||d[e.colorIndex++%d.length]},getItemValue:function(b){return C(V(this.options.valueTemplate,b))},getItemText:function(b){return V(this.options.textTemplate,b)},_getItemColor:function(c){var d=V(this.options.colorTemplate,c);return"undefined"!==d&&null!==d?d:Y},enabled:function(){var h,b=this,g=ac(b.element),f=[].slice.call(arguments);return f.length>0?(h=!!f[0],h?g.removeAttr(Q).removeClass("sui-treemap-disabled"):g.attr(Q,Q).addClass("sui-treemap-disabled"),b.tooltip&&b.tooltip.enabled(h),b._enabled=h,void 0):b._enabled},destroy:function(){var f,b=this,e=b._eventNS;for(ac(F).off(e),clearTimeout(b._onWinResTimeout),b._onWinResTimeout=null,b.dataSource&&b.dataSource.off(e),b.tooltip&&(b.tooltip.destroy(),b.tooltip=null),f=0;f<b.containers.length;f++){b.containers[f].off(P)}b.containers=null,ac(b.element).empty(),O.fn.destroy.call(b)}}),R.defaults=G,aa.ui.plugin("TreeMap",R)}(jQuery,shield,this);