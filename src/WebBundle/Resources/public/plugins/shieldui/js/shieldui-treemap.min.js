/* Shield UI 1.7.18 Trial Version | Copyright 2013-2015 Shield UI Ltd. | http://www.shieldui.com/eula */
!function(b,d,w,f){"use strict";var v,m,a,e,u,q,t,p=d.ui.Widget,r=d.Class,A=d.DataSource,B=(document,Math.abs,Math.min),y=Math.max,k=Math.pow,j=(Math.floor,b.proxy),i=(b.each,b.map,d.format),z=d.to["int"],s=d.error,h=d.is,l=h.defined,x=(h.string,h.object,h.func,d.to.number,"squarified"),c="horizontal",g="vertical",o="click",n="disabled";a=r.extend({init:function(b,c,d,e){var a=this;a.left=b,a.top=c,a.width=d,a.height=e},getSize:function(){return B(this.width,this.height)},getRowContainers:function(b){var a,c=this,d=c.left,e=c.top,i=c.sum(b),f=i/c.height,g=i/c.width,h=[];if(c.width>=c.height)for(a=0;a<b.length;a++)h.push({left:d,top:e,right:d+f,bottom:e+b[a].targetValue/f,dataItem:b[a]}),e+=b[a].targetValue/f;else for(a=0;a<b.length;a++)h.push({left:d,top:e,right:d+b[a].targetValue/g,bottom:e+g,dataItem:b[a]}),d+=b[a].targetValue/g;return h},remainingArea:function(f){var c,d,g,h,e,b=this;return b.width>=b.height?(c=f/b.height,g=b.width-c,e=new a(b.left+c,b.top,g,b.height)):(d=f/b.width,h=b.height-d,e=new a(b.left,b.top+d,b.width,h)),e},sum:function(b){var a,c=0;for(a=0;a<b.length;a++)c+=b[a].targetValue;return c}}),e=r.extend({init:function(){},sort:function(a){a.sort(function(a,b){return b.targetValue-a.targetValue})},sum:function(b){var a,c=0;for(a=0;a<b.length;a++)c+=b[a].targetValue;return c},min:function(c){var a,b=f;for(a=0;a<c.length;a++)(!l(b)||b>c[a].targetValue)&&(b=c[a].targetValue);return b},max:function(c){var a,b=f;for(a=0;a<c.length;a++)(!l(b)||b<c[a].targetValue)&&(b=c[a].targetValue);return b}}),e.create=function(a){return a===x?new t:a===c?new u:new q},u=e.extend({init:function(){e.fn.init.apply(this,arguments)},execute:function(k,f,q,h,e){var m,j,b,i,d,l,n=this,r=n.sum(k),o=f.left,p=f.top;for(e||(e=c),n.sort(k),l=0;l<k.length;l++)b=k[l],m=e===c?f.width*b.targetValue/r:f.width,j=e===c?f.height:f.height*b.targetValue/r,b.items&&0!==b.items.length?(i=h.createGroup(q,new a(o,p,m,j)),d=h.createTitle(i,h.getItemText(b)),d=new a(d.left-i.position().left,d.top-i.position().top,d.width,d.height),n.execute(b.items,d,i,h,e===c?g:c)):h.createItem(q,{left:o,top:p,width:m,height:j,dataItem:b}),e===c?o+=m:p+=j}}),q=e.extend({init:function(){e.fn.init.apply(this,arguments)},execute:function(k,f,q,h,e){var m,j,b,i,d,l,n=this,r=n.sum(k),o=f.left,p=f.top;for(e||(e=g),n.sort(k),l=0;l<k.length;l++)b=k[l],j=e===g?f.height*b.targetValue/r:f.height,m=e===g?f.width:f.width*b.targetValue/r,b.items&&0!==b.items.length?(i=h.createGroup(q,new a(o,p,m,j)),d=h.createTitle(i,h.getItemText(b)),d=new a(d.left-i.position().left,d.top-i.position().top,d.width,d.height),n.execute(b.items,d,i,h,e===g?c:g)):h.createItem(q,{left:o,top:p,width:m,height:j,dataItem:b}),e===g?p+=j:o+=m}}),t=e.extend({init:function(){e.fn.init.apply(this,arguments)},execute:function(l,i,k,d){var j,h,b,f,c,g,e=this;for(e.sort(l),j=e._squarifyCore(e._normalize(l,i.width*i.height,d),[],i,[]),h=e._getTreemap(j),g=0;g<h.length;g++)b=h[g],b.dataItem.items&&0!==b.dataItem.items.length?(f=d.createGroup(k,new a(b.left,b.top,b.right-b.left,b.bottom-b.top)),c=d.createTitle(f,d.getItemText(b.dataItem)),c=new a(c.left-f.position().left,c.top-f.position().top,c.width,c.height),e.execute(b.dataItem.items,c,f,d)):d.createItem(k,{left:b.left,top:b.top,width:b.right-b.left,height:b.bottom-b.top,dataItem:b.dataItem})},_squarifyCore:function(d,a,b,c){var g,f,h,e=this;return 0===d.length?void c.push(b.getRowContainers(a)):(g=b.getSize(),f=d[0],e._verifyRatio(a,f,g)?(a.push(f),e._squarifyCore(d.slice(1),a,b,c)):(h=b.remainingArea(e.sum(a)),c.push(b.getRowContainers(a)),e._squarifyCore(d,[],h,c)),c)},_getTreemap:function(c){var a,b,d=[];for(a=0;a<c.length;a++)for(b=0;b<c[a].length;b++)d.push(c[a][b]);return d},_verifyRatio:function(a,g,c){var b,d,e,f=this;return 0===a.length?!0:(b=a.slice(),b.push(g),d=f._calculateRatio(a,c),e=f._calculateRatio(b,c),d>=e)},_calculateRatio:function(a,c){var b=this,e=b.min(a),f=b.max(a),d=b.sum(a);return y(k(c,2)*f/k(d,2),k(d,2)/(k(c,2)*e))},_normalize:function(c,d,h){var a,e=this,f=e.sum(c),g=d/f,b=[];for(a=0;a<c.length;a++)b[a]=c[a],b[a].targetValue=b[a].targetValue*g;return b}}),v={cls:f,enabled:!0,width:f,height:f,title:f,dataSource:f,readDataSource:!0,type:"squarified",valueTemplate:"{value}",textTemplate:"{title}",colorTemplate:"{color}",colors:["#1E98E4","#FFC500","#5CB85C","#FF2A00","#6D31FF","#00B2A1","#FF8000","#84B3DC"],tooltip:{enabled:!1,template:"{title}: {value}",filter:".sui-treemap-item",delay:80,position:"top"},events:{}},m=p.extend({init:function(){p.fn.init.apply(this,arguments);var e,a=this,d=b(a.element),c=a.options,f=c.cls,g=c.dataSource,h=c.dieOnError;return"div"!==d.prop("tagName").toLowerCase()?void s("shieldTreeMap: Underlying element is not DIV.",h):(d.addClass("sui-treemap "+(f?" "+f:"")),l(c.width)&&d.css("width",c.width),l(c.height)&&d.css("height",c.height),g?(a.dataSource=A.create(g),a._eventNS=e=".shieldTreeMap"+a.getInstanceId(),a.containers=[],a.colorIndex=0,b(w).on("resize"+e,j(a._onWinResize,a)),a.dataSource.on("change"+e,j(a._dsChange,a)),c.readDataSource&&a.dataSource.read(),void a.enabled(c.enabled)):(a.destroy(),void s("shieldTreemap: dataSource is not defined.",h)))},_dsChange:function(){var a=this,b=a.element;a._create(),a._createTooltip(),a._elWidth=b.width(),a._elHeight=b.height()},_onWinResize:function(b){var a=this;a._onWinResTimeout&&clearTimeout(a._onWinResTimeout),a._onWinResTimeout=setTimeout(j(a._winResized,a),100)},_winResized:function(){var a=this,b=a.element;(a._elWidth!==b.width()||a._elHeight!==b.height())&&a.refresh()},_createTooltip:function(){var a=this,c=a.options.tooltip;c.enabled&&(a.tooltip?a.tooltip.refresh(c):a.tooltip=b(a.element).children(".sui-treemap-group").first().shieldTooltip(c).swidget())},_create:function(){var d,b=this,c=b.element,g=b.dataSource.data,h=b.options,i=e.create(h.type),f=new a(0,0,c.innerWidth(),c.innerHeight());c.empty(),b._prepareData(g),d=b.createGroup(c,f),f=b.createTitle(d,h.title),i.execute(g,f,d,b)},_prepareData:function(b){var a,c=this;for(a=0;a<b.length;a++)b[a].targetValue=c.getItemValue(b[a]),b[a].items&&c._prepareData(b[a].items)},createTitle:function(e,i){var g,j,k,l,m,n=this,h=n.options.type===c;return"undefined"===i||i===f?new a(e.position().left,e.position().top,e.innerWidth(),e.innerHeight()):(g=b('<div class="sui-treemap-title"></div>').appendTo(e),h&&g.innerHeight(e.outerHeight()),g.append('<div class="sui-treemap-title-inner">'+i.replace(/\s+/,"&nbsp;")+"</div>"),d.ui.Position.Set(g.find(".sui-treemap-title-inner"),g,{source:"center",target:"center"}),j=h?e.position().left+g.outerWidth():e.position().left,k=h?e.position().top:e.position().top+g.outerHeight(),l=h?e.innerWidth()-g.outerWidth():e.innerWidth(),m=h?e.innerHeight():e.innerHeight()-g.outerHeight(),new a(j,k,l,m))},createGroup:function(b,c){var a=this;return a._createContainer(b,c).addClass("sui-treemap-group sui-treemap-group-"+a.options.type)},createItem:function(g,b){var d,a=this,e=a.options,f=e.tooltip,h=(e.type===c,a.getItemText(b.dataItem));d=a._createContainer(g,b),d.addClass("sui-treemap-item").css("backgroundColor",a._getContentColor(b.dataItem)).on(o,j(a._contentClick,a,b.dataItem)),f.enabled&&d.attr("title",i(f.template,b.dataItem)),a.containers.push(d),d.html(h)},_contentClick:function(b){var a=this;a._enabled&&a.trigger(o,{title:a.getItemText(b),value:a.getItemValue(b),item:b})},_createContainer:function(c,a){return b("<div/>").appendTo(c).css({left:a.left,top:a.top,width:a.width,height:a.height})},_getContentColor:function(c){var a=this,b=a.options.colors;return a._getItemColor(c)||b[a.colorIndex++%b.length]},getItemValue:function(a){return z(i(this.options.valueTemplate,a))},getItemText:function(a){return i(this.options.textTemplate,a)},_getItemColor:function(b){var a=i(this.options.colorTemplate,b);return"undefined"!==a&&null!==a?a:f},enabled:function(){var c,a=this,d=b(a.element),e=[].slice.call(arguments);return e.length>0?(c=!!e[0],c?d.removeAttr(n).removeClass("sui-treemap-disabled"):d.attr(n,n).addClass("sui-treemap-disabled"),a.tooltip&&a.tooltip.enabled(c),a._enabled=c,void 0):a._enabled},destroy:function(){var c,a=this,d=a._eventNS;for(b(w).off(d),clearTimeout(a._onWinResTimeout),a._onWinResTimeout=null,a.dataSource&&a.dataSource.off(d),a.tooltip&&(a.tooltip.destroy(),a.tooltip=null),c=0;c<a.containers.length;c++)a.containers[c].off(o);a.containers=null,b(a.element).empty(),p.fn.destroy.call(a)}}),m.defaults=v,d.ui.plugin("TreeMap",m)}(jQuery,shield,this);