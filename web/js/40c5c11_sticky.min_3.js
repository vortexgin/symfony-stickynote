var noteTPL='<div class="panel panelis panel-default col col-md-2 col-xs-12" style="{{position}}"><div class="panel-heading"><input type="hidden" name="id"><input type="text" name="name" class="form-control" placeholder="Title"><a href="#" class="move"><i class="fa fa-arrows-alt"></i></a><a href="#" class="close"><i class="fa fa-window-close"></i></a></div><div class="panel-body"><textarea name="message" class="form-control" rows="3" placeholder="Content"></textarea></div><div class="panel-footer hide"><span class="updated"></span><button class="save btn btn-primary">Save</button></div></div>';var noteZindex=1;function deleteNote(){$(this).parent(".panel-heading").parent(".panel").hide("puff",{percent:133},250)}function saveNote(){if($(this).hasClass("panel")){var h=$(this).find("input[name=id]"),c=$(this).find("input[name=name]"),e=$(this).find("textarea[name=message]"),a={top:$(this).offset().top,left:$(this).offset().left},d=false}else{var h=$(this).parent(".panel-footer").parent(".panel").find("input[name=id]"),c=$(this).parent(".panel-footer").parent(".panel").find("input[name=name]"),e=$(this).parent(".panel-footer").parent(".panel").find("textarea[name=message]"),a={top:$(this).parent(".panel-footer").parent(".panel").offset().top,left:$(this).parent(".panel-footer").parent(".panel").offset().left},d=true}var f={name:c.val(),message:e.val(),position:JSON.stringify(a)},g="POST",b="/api/v1/sticky";if(!empty(h.val())){g="PATCH";b+="/"+h.val()}$.ajax({url:b,method:g,data:f,beforeSend:function(){if(d){$("body").swidget().show()}},complete:function(){if(d){$("body").swidget().hide()}},success:function(j,k,i){if(d){toastr.success("Save success")}},error:function(i){toastr.error(i.responseJSON.message)}})}function loadNote(){$.ajax({url:"/api/v1/sticky",method:"GET",beforeSend:function(){$("body").swidget().show()},complete:function(){$("body").swidget().hide()},success:function(b,c,a){b.sticky.forEach(function(e,d){newNote(e)},this)}})}function newNote(g){var h=g.id||"",d=g.name||"",f=g.message||"",a=g.position||'{"top": 10, "left": 10}',b=g.updated_at||g.created_at;if(!empty(a)){var e=JSON.parse(a);if(e.top!=10&&e.left!=10){console.log(noteTPL);noteTPL=noteTPL.replace("{{position}}","top:"+e.top+"; left:"+e.left);console.log(noteTPL)}}var c=$(noteTPL).hide().appendTo("#board").show("fade",300).attr("id","sticky-"+h).draggable().on("dragstart",function(){$(this).css("z-index",++noteZindex)}).on("dragstop",saveNote);c.find("input[name=id]").val(h);c.find("input[name=name]").val(d);c.find("textarea[name=message]").val(f);if(!empty(b)){c.find(".updated").html("<i>Last updated</i><br />"+b)}c.find(".close").click(deleteNote);c.find(".save").click(saveNote);$(".panel-heading input, .panel-body textarea").focus(activeNote)}function activeNote(){var a=$(this).parent().parent(".panel").find(".panel-footer");if(a.hasClass("hide")){a.removeClass("hide")}}function deactiveNote(){var a=$(this).find(".panel-footer");if(!a.hasClass("hide")){a.addClass("hide")}}$(document).ready(function(){$("body").shieldLoadingPanel({text:"loading..."});$("#board").height($(document).height());$("#addNew").click(newNote);loadNote();return false});